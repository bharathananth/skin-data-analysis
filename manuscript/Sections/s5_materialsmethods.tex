\subsection*{Experimental design and collection of human skin samples}
The study to obtain human skin biopsies was approved by the Beiersdorf AG Legal Review Board. Tissue samples were collected according to the recommendations of the Declaration of Helsinki and to applicable laws for a non-drug study. All donors provided written and informed consent. \textcolor{red}{The study was performed at the study center of Beiersdorf AG.} Eleven healthy volunteers (six males, five females, aged 20-30\,years) participated in the study. Individual chronotypes were assessed using the Munich Chronotype Questionnaire (MCTQ) by calculating the mid sleep time on free days adjusted for the sleep-debt accumulated during the workweek MSF\textsubscript{sc} \cite{Vetter2021}. \textcolor{red}{What about meals? Physical activity?} All information about the subjects is provided in Supplementary Table \ref{tab:supptab1}. \todo{Please check this paragraph. Anything incorrect/missing?} %All subjects were provided with regularly scheduled meals without specific dietary restrictions and were not allowed to perform any exhaustive physical activities. No food was served after 10 PM. Wu-Hogenesch 2018 https://www.pnas.org/content/pnas/suppl/2018/10/29/1809442115.DCSupplemental/pnas.1809442115.sapp.pdf

Three millimeter biopsies were obtained from the upper back for seven time points over a period of 24\,h (8:00, 12:00, 16:00, 20:00, 00:00, 04:00 and 8:00 the following day). Skin biopsies were subsequently incubated in PBS at \textcolor{red}{55\,\textsuperscript{o}C for 3\,min} to separate epidermis and dermis. Tissue samples were then frozen in liquid nitrogen and stored at -80\,\textsuperscript{o}C. \textcolor{red}{RNA extraction and quality control from punch-biopsies was performed by Miltenyi Biotec using the TRIzol method. Linear amplification and labeling of RNA and hybridization of Agilent Whole Genome Oligo Microarrays 4x44k (Agilent Technologies) using 1.2--1.65\,\textmu g of Cy3-labeled cRNA was performed by Miltenyi Biotec, essentially as reported in \cite{Duggan1999}.}  \todo{Please check this paragraph. Anything incorrect/missing?}

\subsection*{Gene expression analysis}
The microarray gene expression analysis was conducted in R. The \textcolor{red}{RMA} (Robust Multichip Average) algorithm was used to pre-process and extract expression profiles from the raw CEL files. Transcripts were annotated with ENSEMBL and ENTREZ IDs using \textcolor{red}{Agilent ``Human Genome, Whole'' annotation data (hgug4112a.db, v3.2)}. The raw gene expression data has been deposited in the Gene Expression Omnibus (GEO) under the accession number \textcolor{red}{GSExxxxx}. 

Raw data of the hybridized microarrays were normalized and processed using the Bioconductor R-Project package Linear Models for Microarray Data (\texttt{limma}). Background correction, normalization between the different arrays, removal of non-annotated probes, lowly-expressed genes as well as control probes was performed as suggested by the \texttt{limma} user-guide. The filtered and annotated dataset contains 11578 expressed genes. %Genes were considered to be expressed if the \textcolor{red}{signal across the 7 time points was well above the background signal in at least 50\% of the microarrays}. Lowly-expressed genes were removed from further analysis. The expression of genes annotated by multiple ENSEMBL IDs was averaged across replicates using the \texttt{avereps} function from \texttt{limma}, resulting in a filtered dataset containing data for 11578 transcripts. \\

Principal Component Analysis (PCA) was performed in order to remove outliers. The expressed genes nicely organized in two clusters in PCA space, separated by skin layer (data not shown). Nevertheless, the epidermis sample from subject 109 taken at 8:00 the following day did not cluster with the rest of epidermal samples and for this reason was removed from further analyses. 

\subsection*{Rhythmicity analysis and functional annotation of circadian gene lists}
To detect genes exhibiting rhythmic behavior with a 24\,h period in their expression we used differential rhythmicity analysis as decribed in \cite{Pelikan2021}. Acrophases and amplitudes were estimated from the analysis and used to identify significant oscillating genes. A false discovery rate $<0.05$ and a peak-to-trough fold change amplitude $>1.5$ were used to filter for expressed genes with significant rhythms in dermis \textit{or} epidermis. In analyses where \textit{internal} time was used, sampling (wall) time was corrected to internal time in each subject by subtracting the mid-sleep time on free days after correcting for sleep debt during week days ($\textrm{MSF}_\textrm{sc}$ \cite{Vetter2021}) to wall time. %Each microarray was assigned to its corresponding skin layer and time-group (i.e., 8\,AM, 12\,PM, 4\,PM, 8\,PM, 12\,AM, 4\,AM or 8\,AM the following day). 
%A linear model was then fitted to the expression data for each probe using the \texttt{lmFit} function from the \texttt{limma} package. Subsequently, a moderated F-test of the empirical Bayes statistics for differential expression (\texttt{eBayes} function from the \texttt{limma} package) was applied to test differential gene expression between the respective groups for statistical significance. The \texttt{topTable} function from \texttt{limma} was used to summarize the linear model fit object produced by \texttt{lmFit} and processed by \texttt{eBayes}. \\ %An offset of 20 was added to stabilize the background and, subsequently, signals were log2-transformed. Genes were considered to be expressed if the background-subtracted signal was above 2.6 times the SD of the background signal in at least 75\,\% of the microarrays. 
%Genes showing significant diurnal expression patterns were tested for over-representation in Gene Ontology (GO) terms and Kyoto Encyclopedia of Genes and Genomes (KEGG) pathways against the background of expressed transcripts in the skin using the \texttt{clusterProfiler} package. 
Circadian Gene Ontology (GO) terms and Kyoto Encyclopedia of Genes and Genomes (KEGG) pathways were determined by Phase Set Enrichment Analysis \cite{Zhang2016} based on the sets of circadian genes in each layer (although with a less strict FDR cutoff of 0.1). Gene sets were downloaded from the Molecular Signatures database (MSigDB) C2 (KEGG gene sets) and C5 (GO:BP terms) \cite{Subramanian2005}. Sets containing fewer than five circadian transcripts were excluded from the analysis. The Kuiper test was used to identify circadian gene sets by comparing the acrophases of all circadian transcripts (rounded to the full hour) belonging to each gene set to a uniform background distribution and by testing for nonuniformity ($q<0.05$ for GO terms, $q<0.25$ for KEGG pathways).
%A full description of all versions and references of R packages used is provided in Supplementary Table \ref{tab:supptab2}. 

\subsection*{Assessment of variability in circadian parameters across subjects and skin layers}
In order to analyze how magnitudes, amplitudes and phases of individual circadian genes vary across subjects and layers we analyzed each gene separately using the linear-mixed-model \cite{Bates2015, Laird1982, Hoffman2016}. The expression of gene $i$, $g_i$, is expressed as 
\begin{equation*}
\begin{split}
g_i &= (m_i + \Delta m_{i,subj} + \Delta m_{i,layer}) + (a_i + \Delta a_{i,subj} + \Delta a_{i,lay}) \cos \omega t + (b_i + \Delta b_{i,subj} + \Delta b_{i,layer}) \sin \omega t,
\end{split}
\end{equation*}
where $m_i, a_i$ and $b_i$ represent the coefficients of the fixed effects for gene $i$; and $\Delta m_{i}, \Delta a_{i}$ and $\Delta b_{i}$ represent the random effects attributed to differences across layers or subjects, which are drawn from a normal distribution whose variance is estimated. 

While $m_i$ is a direct readout of the gene's magnitude (and its respective uncertainty attributed to layers/subjects), amplitude $A_i$ and phase $\phi_i$ of a gene $i$ were calculated from the coefficients $a_i$ and $b_i$ for each gene as $A_i=\sqrt{a_i^2 + b_i^2}$ and $\phi_i=\arctan\frac{b_i}{a_i}$. To determine the variability in amplitude and phase across subjects and layers we used error propagation. The variance of amplitude and phase across subjects and layers was computed from the Jacobian matrices $\mathbb{J}_i$ and the covariance matrices $\Sigma_i$ of the rhythmic parameters (obtained from the linear mixed-model fits) as $\sigma^2_{A,i} = \mathbb{J}_{A,i} \Sigma_{A,i} \mathbb{J}_{A,i}^\mathrm{T}$ (and  $\sigma^2_{\phi,i} = \mathbb{J}_{\phi,i} \Sigma_{\phi,i} \mathbb{J}_{\phi,i}^\mathrm{T}$), where $\mathbb{J}_{A,i}=\left( \frac{\partial A_i}{\partial m_i} \  \frac{\partial A_i}{\partial a_i} \  \frac{\partial A_i}{\partial b_i} \right)$ (and $\mathbb{J}_{\phi,i}=\left( \frac{\partial \phi_i}{\partial m_i} \  \frac{\partial \phi_i}{\partial a_i} \  \frac{\partial \phi_i}{\partial b_i} \right)$).

\subsection*{Identification of predictive biomarkers of molecular skin phase}
We used ZeitZeiger \cite{Hughey2016} to identify skin biomarkers of circadian phase. We tested two sets of predictors using the whole set of skin-expressed genes in epidermis or dermis separately. The predicted variable was, in both cases, internal time. To evaluate the performance of the predictors, we followed a leave-one-subject-out cross-validation approach in the lines of \cite{Hughey2016, Wittenbrink2018}. To do this, predictors are trained with data from all subjects except one and internal time from the subject who is left-out is predicted. The process is iterated along all subjects and for different values of the two main parameters of ZeitZeiger, \texttt{sumabsv} and \texttt{nSPC}. The first parameter \texttt{sumabsv} controls how many genes form each sparse principal component (SPC) and the second parameter, \texttt{nSPC}, controls how many SPCs are used for prediction. Large values of either parameter result in more genes being needed for prediction. For each set of values of \texttt{sumabsv} and \texttt{nSPC} from the leave-one-subject-out cross-validation, we calculated the median absolute difference between the predicted and the observed internal time stamp across all subjects. We refer to this parameter as median absolute error (MAE), and it serves as a measure of accuracy of the prediction: the lower the error, the better the prediction. 

%In terms of optimal number of SPCs, \textcolor{red}{all} predictors performed comparably well, since the MAE did not decrease much after 2 SPCs. However, the optimal value of \texttt{sumabsv} and, consequently, the number of genes used for prediction, differed in each approach. Running ZeitZeiger in the whole set of skin-expressed genes (in either dermis \textit{or} epidermis) resulted in a minimum MAE of $\sim0.08$ for \texttt{nSPC}=2 and \texttt{3} (Figure \textcolor{red}{suppfig4A}) with 38 genes needed for prediction (Figure \textcolor{red}{suppfig4B}). On the other hand, running ZeitZeiger in each skin layer separately performed better, as seen by the lower MAE and the lower number of genes needed to predict internal time: 2 SPCs and \texttt{sumabsv}=2 resulted in a MAE of 0.04 (Figure \ref{fig:fig3}A), and 15-25 genes needed for prediction (Figure \ref{fig:fig3}B, time series in \textcolor{red}{suppfig5A}).\\




